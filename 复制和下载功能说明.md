# 复制和下载功能实现说明

## 功能概述

已成功为 ds-markdown 项目实现了代码块的复制和下载功能。当启用 `codeBlock.headerActions` 属性时，代码块会显示复制和下载按钮。

## 功能截图

用户可以看到类似图片中的效果：

- 📋 复制按钮：将代码内容复制到剪贴板
- ⬇️ 下载按钮：将代码内容下载为文件

## 使用方法

### 基本用法

```tsx
import Markdown from 'ds-markdown';

function MyComponent() {
  const markdownContent = `
# 示例代码

\`\`\`javascript
function greet(name) {
  console.log('Hello, ' + name + '!');
  return 'Hello, ' + name + '!';
}

greet('World');
\`\`\`
  `;

  return (
    <Markdown theme="light" codeBlock={{ headerActions: true }}>
      {markdownContent}
    </Markdown>
  );
}
```

### 配置选项

#### `codeBlock.headerActions`

- **类型**: `boolean | React.ReactNode`
- **默认值**: `false`
- **说明**:
  - 当设置为 `true` 时，显示默认的复制和下载按钮
  - 当设置为 `React.ReactNode` 时，显示自定义的头部操作组件

#### 示例配置

```tsx
// 启用默认按钮
<Markdown codeBlock={{ headerActions: true }}>
  {content}
</Markdown>

// 自定义头部操作
<Markdown
  codeBlock={{
    headerActions: (
      <div>
        <button>自定义按钮1</button>
        <button>自定义按钮2</button>
      </div>
    )
  }}
>
  {content}
</Markdown>
```

## 功能特性

### 复制功能

1. **现代浏览器支持**: 使用 `navigator.clipboard.writeText()` API
2. **降级兼容**: 自动降级到传统的 `document.execCommand('copy')` 方法
3. **视觉反馈**: 点击后按钮文本变为"已复制"，2秒后恢复
4. **错误处理**: 复制失败时会在控制台输出错误信息

### 下载功能

1. **智能文件扩展名**: 根据代码语言自动确定文件扩展名
   - JavaScript → `.js`
   - TypeScript → `.ts`
   - Python → `.py`
   - Java → `.java`
   - C++ → `.cpp`
   - CSS → `.css`
   - HTML → `.html`
   - JSON → `.json`
   - 等等...
2. **默认文件名**: `code.{extension}`
3. **UTF-8编码**: 确保多语言字符正确保存

### 支持的编程语言

```
javascript, typescript, jsx, tsx, python, java, cpp, c, csharp, php, ruby, go, rust, swift, kotlin, scala, shell, bash, powershell, sql, html, css, scss, less, json, xml, yaml, markdown, dockerfile
```

## 样式主题

按钮样式会自动适配当前主题：

### 亮色主题

- 背景：半透明黑色
- 文字：深灰色
- 悬停：更深的背景色

### 暗色主题

- 背景：半透明白色
- 文字：浅灰色
- 悬停：更亮的背景色

## 技术实现

### 文件修改

1. **`src/components/BlockWrap/index.tsx`**

   - 添加复制和下载逻辑
   - 实现按钮组件和交互
   - 添加文件扩展名映射

2. **`src/components/BlockWrap/index.less`**

   - 添加按钮样式
   - 实现主题适配
   - 添加悬停和动画效果

3. **`src/components/HighReactMarkdown/index.tsx`**
   - 传递代码内容到 `BlockWrap` 组件

### 核心代码

```tsx
// 复制功能
const handleCopy = async () => {
  if (!codeContent) return;

  try {
    await navigator.clipboard.writeText(codeContent);
    setCopyText('已复制');
    setTimeout(() => setCopyText('复制'), 2000);
  } catch (err) {
    // 降级方案
    const textArea = document.createElement('textarea');
    textArea.value = codeContent;
    document.body.appendChild(textArea);
    textArea.select();
    document.execCommand('copy');
    document.body.removeChild(textArea);
  }
};

// 下载功能
const handleDownload = () => {
  const blob = new Blob([codeContent], { type: 'text/plain;charset=utf-8' });
  const url = URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.href = url;
  link.download = `code.${getFileExtension(language)}`;
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
  URL.revokeObjectURL(url);
};
```

## 测试

访问开发服务器 (如 http://localhost:5173) 并在 Markdown 内容中包含代码块：

```markdown
\`\`\`javascript
console.log('Hello World');
\`\`\`
```

确保在组件中启用了 `codeBlock={{ headerActions: true }}`。

## 浏览器兼容性

- **复制功能**: 支持所有现代浏览器，IE9+ (降级模式)
- **下载功能**: 支持所有现代浏览器，IE10+
- **CSS样式**: 支持所有现代浏览器

## 注意事项

1. 复制功能需要 HTTPS 环境或 localhost 才能使用现代 Clipboard API
2. 下载功能可能会被浏览器的下载策略限制
3. 某些浏览器可能会询问用户是否允许下载文件

## 完成状态

✅ 复制功能实现  
✅ 下载功能实现  
✅ 主题适配完成  
✅ 错误处理完成  
✅ 浏览器兼容性处理  
✅ 文件扩展名智能识别  
✅ 视觉反馈实现
